const mongoose = require('mongoose');
require('dotenv').config();
const UsersModel = require('./UsersModel');
const {fetchUserData} = require('../leetCode/userData');

mongoose.connect(process.env.DB_CONNECTION_STRING, { useNewUrlParser: true, useUnifiedTopology: true })
    .then(() => {
    console.log('Connected to MongoDB');
    })
    .catch(err => {
    console.error('Error connecting to MongoDB', err);
    });

async function initUser(discordTag, lcUser){
    const userData = await fetchUserData(lcUser);
    if(userData.status == 'error'){
        throw new Error(userData.message);
    }

    const doc = {
        tag: discordTag,
        user: lcUser,
        easy: userData.easySolved,
        med: userData.mediumSolved,
        hard: userData.hardSolved
    }

    try{
        await SomeModel.findOneAndUpdate({ tag: discordTag }, doc, { new: true, upsert: true });
        return 'User updated successfully!';
    }
    catch(e){
        return e;
    }
}